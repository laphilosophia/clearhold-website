---
interface Props {
  method: 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE'
  path: string
}

const { method, path } = Astro.props

const methodStyles = {
  GET: 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20',
  POST: 'bg-sky-500/10 text-sky-400 border-sky-500/20',
  PUT: 'bg-amber-500/10 text-amber-400 border-amber-500/20',
  PATCH: 'bg-amber-500/10 text-amber-400 border-amber-500/20',
  DELETE: 'bg-rose-500/10 text-rose-400 border-rose-500/20',
}
---

<div class="endpoint-header flex items-center gap-2 p-3 group">
  <div
    class={`method-badge px-3 py-1.5 rounded text-sm font-bold tracking-wider border shadow-sm ${methodStyles[method]}`}
  >
    {method}
  </div>

  <svg
    class="w-4 h-4 text-zinc-600 group-hover:text-zinc-400 transition-colors"
    fill="none"
    viewBox="0 0 24 24"
    stroke="currentColor"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
  </svg>

  <code
    class="endpoint-path text-md! rounded font-mono text-zinc-200 tracking-tight group-hover:text-white transition-colors"
  >
    {path}
  </code>

  <button
    class="copy-button p-1.5 rounded-md hover:bg-white/10 transition-all active:scale-95 group/copy ml-auto"
    data-code={path}
    aria-label="Copy code"
  >
    <svg
      class="w-4 h-4 text-zinc-500 group-hover/copy:text-zinc-300 pointer-events-none"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
    >
      <path
        class="copy-icon"
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
      ></path>
      <path
        class="check-icon hidden"
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M5 13l4 4L19 7"></path>
    </svg>
  </button>
</div>

<script>
  function setupCopyButtons() {
    const buttons = document.querySelectorAll('.copy-button')

    buttons.forEach((button) => {
      button.addEventListener('click', async () => {
        const code = button.getAttribute('data-code')
        if (!code) return

        try {
          await navigator.clipboard.writeText(code)

          const svg = button.querySelector('svg')
          const copyIcon = button.querySelector('.copy-icon')
          const checkIcon = button.querySelector('.check-icon')

          copyIcon?.classList.add('hidden')
          checkIcon?.classList.remove('hidden')
          checkIcon?.classList.add('text-emerald-400')

          setTimeout(() => {
            copyIcon?.classList.remove('hidden')
            checkIcon?.classList.add('hidden')
            checkIcon?.classList.remove('text-emerald-400')
          }, 2000)
        } catch (err) {
          console.error('Failed to copy text: ', err)
        }
      })
    })
  }

  // Run on initial load
  setupCopyButtons()

  // Run on view transitions or dynamic content updates if needed
  document.addEventListener('astro:page-load', setupCopyButtons)
</script>

<style>
  .endpoint-header {
    background: var(--color-bg-surface);
    margin: 2rem 0 1rem;
    border-radius: 0.5rem;
  }

  .method-badge {
    min-width: 64px;
    text-align: center;
  }
</style>
